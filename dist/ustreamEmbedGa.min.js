var UstreamEmbed=function(){function e(e){return n(e)}function n(e){var n=t(e),v=function(e){function n(n){if("socialstream"!==n){if(!L)return P||(P=[]),void P.push(arguments);var r=s(arguments).slice(1);r[0]&&"function"==typeof r[0]&&(U[n]||(U[n]=[]),U[n].push(r[0])),a(e,h,{cmd:n,args:r})}else if(c(window,"message",l),b=t(arguments[1]),E=d(b.getAttribute("src")),O=!0,k.length)for(var i=0,u=k.length;i<u;i++)o(k[i])}function v(){if(P){for(;P.length;)n.apply(this,P.shift());P=null}}function l(e){var n=b;n&&n.contentWindow&&n.contentWindow===e.source?w.onmessage(e):e.source===b.id&&w.onmessage(e)}function p(e){var t,r=JSON.parse(e.data);return r.cmd&&"ready"==r.cmd?void a(b,E,{cmd:"ready"}):(t=[r.cmd],t=t.concat(r.args),void n.apply(this,t))}function y(){a(e,h,{cmd:"ready"})}function m(){L=!0,a(e,h,{cmd:"apihandshake",args:[]}),v(),b&&a(b,E,{cmd:"viewer_ready"})}function g(){n.apply(this,arguments)}var w,h,E,b,L=!1,O=!1,P=[],U={},A={},k=[];return h=d(e.getAttribute("src")).toLowerCase(),e.onload=y,w={host:h,callMethod:g,getProperty:function(){g.apply(this,arguments)},addListener:function(e,n){A[e]||(A[e]=[]),A[e].push(n)},removeListener:function(e,n){if(n)for(var t=0,r=A[e].length;t<r;t++)A[e][t]===n&&A[e].splice(t,1);else A[e]=null},onmessage:function(e){var n;if(h||E||k.push({origin:e.origin,data:e.data}),e.origin.toLowerCase()==h){try{n=JSON.parse(e.data)}catch(e){return}if(n.sstream)return void p(e);if(n.event&&n.event.ready&&(m(),r(A,"ready")),n.event&&n.event.live===!0)return void r(A,"live");if(n.event&&n.event.live===!1)return void r(A,"offline");if(n.event&&!n.event.ready)if(u)Object.keys(n.event).forEach(function(e){r(A,e,n.event[e])});else for(var t in n.event)n.event.hasOwnProperty(t)&&r(A,t,n.event[t]);if(n.property)if(u)Object.keys(n.property).forEach(function(e){i(U,e,n.property[e])});else for(var t in n.property)n.property.hasOwnProperty(t)&&i(U,t,n.property[t])}else if(O&&e.origin==E)return void p(e)},destroy:function(){L=!1,h="",O=!1,E="",b=null,P=[],U={},A={},k=[],f[e.id]&&(f[e.id]=null),e=null}}}(n);return n.id||(n.id="UstreamEmbed"+Math.ceil(1e5*Math.random())),v.id=n.id,f[n.id]=v,v}function t(e){return"string"==typeof e&&(e=document.getElementById(e)),e}function r(e,n,t){for(var r in e[n])e[n].hasOwnProperty(r)&&e[n][r].call(window,n,t)}function i(e,n,t){if(e[n]){var r=e[n];e[n]=null,delete e[n],r.forEach(function(e){e.call(window,t)})}}function o(e){var n,t;for(n in f)f.hasOwnProperty(n)&&f[n]&&(t=document.getElementById(n),t&&t.contentWindow?t.contentWindow===e.source&&f[n].onmessage(e):"string"==typeof e.source&&e.source==n&&f[n].onmessage(e))}function a(e,n,t){e.contentWindow.postMessage(JSON.stringify(t),n)}function d(e){return e.indexOf("http")<0&&(e=location.protocol+e),e.match(v)[1].toString()}function s(e){return Array.prototype.slice.call(e,0)}function c(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent("on"+n,t)}var u="undefined"!=typeof Object.keys,f={},v=new RegExp("^(http(?:s)?://[^/]+)","im");return c(window,"message",o),"function"==typeof define&&define.amd&&define([],function(){return e}),window.UstreamEmbed=e}(),UstreamEmbedGa=function(){function e(e,n){var t=e;return"playing"===e&&(t=n?e:"stopped"),t}function n(n,t){function i(e){var n,t=u.length;for(n=0;n<t;n++)"add"!==e&&e?c.removeListener(u[n],o):c.addListener(u[n],o)}function o(n,t){var r=e(n,t);return window.dataLayer?void dataLayer.push({event:"ustreamTriggerEvent",ustreamEventCategory:d,ustreamEventAction:r,ustreamEventLabel:s}):window.ga?void ga("send","event",{eventCategory:d,eventAction:r,eventLabel:s}):void(window._gaq&&_gaq.push(["_trackEvent",d,r,s]))}function a(){c.getProperty("content",function(e){s=e[0]+"/"+e[1],i("add")})}var d="Ustream video",s="",c=n,u=function(){return t&&t.hasOwnProperty("listenTo")&&t.listenTo instanceof Array&&t.listenTo.length?t.listenTo:r}();return a(),{destroy:i.bind(this,"remove"),init:i.bind(this,"add")}}function t(e,t){if(window.UstreamEmbed&&(window.ga||window._gaq||window.dataLayer))return n(e,t)}var r=["live","offline","finished","playing"];return window.UstreamEmbedGa=t}();